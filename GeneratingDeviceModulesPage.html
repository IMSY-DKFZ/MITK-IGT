<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MITK-IGT: How to generate ToF DeviceModules</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">MITK-IGT
   </div>
   <div id="projectbrief">IGT Extension of MITK</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('GeneratingDeviceModulesPage.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">How to generate ToF DeviceModules</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The <b> ToF-DeviceModule-Tutorial</b> will help you implementing a new ToF-Device easily. Using MicroServices for this purpose will be one of our main goals, too.</p>
<p>If you do not know much about MicroServices, please take a look at:</p>
<p>MicroServices_Overview</p>
<h1><a class="anchor" id="GeneratingDeviceModulsPageSec1"></a>
Generating a ToF-Device-Module in MITK</h1>
<p>In order to implement your own device, you need to code the following objects: </p><ul>
<li>
device (the device itself) </li>
<li>
device factory (a singleton which produces instances of your device) </li>
<li>
controller (connection to the Hardware-SDK) </li>
<li>
Module Activator (Important for the MicroServices. This class ensures the automatic loading of the device.) </li>
</ul>
<p>The following example shows how to implement a device, here we take the Kinect.</p>
<ol>
<li>
<p class="startli"><b> Creating a Sub-Folder</b> <br  />
 Following the Kinect-DeviceModule as a prototype, create a <em>MODULENAME-Sub-Folder</em> in your source directory. This MODULENAME-Folder is going to hold all the necessary files we will create in the next steps.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><b> Create the <em>CMake Files</em> for our new camera-model in the MODULENAME-Folder &lt;</b> </p><ul>
<li>
<p class="startli">CMakeList.txt</p>
<p class="interli">In this file, the module is generated via CMake commands. The module name is set, the necessary libraries will be searched here in order to link them with your module. For the Kinect, we chose OpenNI and need the XnCppWrapper.h. Your device must inherit from the mitkToFCameraDevice and consequently your module must depend on mitkToFHardware -&gt; what is the reason for the <em>DEPENDS mitkToFHardware</em> -line. For autoloading your Module with mitkToFHardware, insert the following CMake Macro: <em>AUTOLOAD_WITH mitkToFHardware</em> . We usually add an option for the user to activate the device module, but this is not essential (refer to <em> OPTION(MITK_USE_TOF_KINECT "Enable support for Kinect camera" OFF)</em>). <br  />
 -&gt; refer to CMakeList.text in the Kinect-Folder</p>
<p class="interli">Warning: The dll/so files are not automatically deleted.</p>
<p class="endli"><br  />
</p>
</li>
<li>
files.cmake The files.cmake contains all the previously mentioned files (device, deviceFactory, controller, and ModuleActivator) <br  />
 -&gt; refer to <a class="el" href="mitkKinectActivator_8cpp.html">mitkKinectActivator.cpp</a> </li>
</ul>
<p class="endli"></p>
</li>
<li>
<b> Creating the Code Files in the MODULENAME-Folder </b> <ul>
<li>
<p class="startli"><em>MODULENAMEController</em> <br  />
 -&gt; While referring to mitkKinectcontroller.cpp and the mitkKinectcontroller.h, take a good look at the definition of the MITK_KINECTMODULE_EXPORT-class in the .h file</p>
<p class="endli"><br  />
</p>
</li>
<li>
<p class="startli"><em>MODULENAMEDevice</em> Your device must inherit from ToFCameraDevice (e.g. class MITK_KINECTMODULE_EXPORT KinectDevice : public ToFCameraDevice) and consequently implement the methods of the ToFCameraDevice MicroService-Interface. (See ToFCameraDevice.h). Make sure to give your device a specific name in the method GetDeviceName(). All instances of your device will automatically be available in the view "ToFUtil", if you generate it via the factory. <br  />
 -&gt; refer to <a class="el" href="mitkKinectDevice_8cpp.html">mitkKinectDevice.cpp</a> and the <a class="el" href="mitkKinectDevice_8h.html">mitkKinectDevice.h</a>.</p>
<p class="endli"><br  />
</p>
</li>
<li>
<p class="startli"><em>MODULENAMEDeviceFactory</em> Like the mitkToFCameraDevice, the mitkIToFDeviceFactory is a MicroService-Interface. The factory is meant for generation of devices of the same type. This concept allows for having multiple instances of the same camera connected. (Currently our GUI does not really support an actual connection of multiple devices, but the software framework, in principle, does.) Your factory must inherit from the mitkAbstractDeviceFactory, which provides some useful methods for device generation. Your factory instance should be registered as MicroService in order to be available in the view "ToF Device Generation". <br  />
 -&gt; refer to <a class="el" href="mitkKinectDeviceFactory_8cpp.html">mitkKinectDeviceFactory.cpp</a> and the <a class="el" href="mitkKinectDeviceFactory_8h.html">mitkKinectDeviceFactory.h</a></p>
<p class="endli"><br  />
</p>
</li>
<li>
<em>MODULENAMEActivator</em> The load() method of this class will be called when the module is activated. If you would like to have an instance of your device registered as MicroService, you should call deviceFactory-&gt;ConnectToFDevice(); here. In addition, you can generate devices anywhere in your code via this method. The factory will automatically be available in the view "ToF Device Generation" if you register it like we do with the Kinect. TODO: Code example: <br  />
 -&gt;refer to <a class="el" href="mitkKinectActivator_8cpp.html">mitkKinectActivator.cpp</a> and the mitkKinectActivator.h or the <a class="el" href="mitkPMDModuleActivator_8cpp.html">mitkPMDModuleActivator.cpp</a> and the mitkPMDModuleActivator.h. </li>
</ul>
</li>
</ol>
<p><br  />
 If you did everything correct, your Module should be implemented an executable MODULENAME-Project will be generated and a working device should show up in the ServiceListWidget in the Connection-Part of ToFUtil. <b>Warning</b> The dll/so files are not automatically deleted. After deactivating a device, please delete the concerning files in <em>SUPERBUILDDIR/MITK-build/bin/mitkToFHardware/BUILDTYPE</em></p>
<h1><a class="anchor" id="GeneratingDeviceModulsPageSec2"></a>
[OPTIONAL] Adding a Testing Sub-Directory</h1>
<p>If you have any Tests you want to include, a <em>Testing-Subdirectory</em> in the newly created MODULENAME-Folder should be created. In this Folder we are going to put a CMakeLists.txt and a files.cmake the first one will just consist </p><pre class="fragment">\code
MITK_CREATE_MODULE_TESTS()
\endcode
</pre><p>while the later one, the files.cmake holds Information about TestFiles you created and put in the Folder. E.g. for the Kinect:</p>
<div class="fragment"><div class="line">set(MODULE_TESTS</div>
<div class="line"><a class="code hl_function" href="mitkKinectControllerTest_8cpp.html#a88962bc6795136a50957a8d5450b52f1">mitkKinectControllerTest</a>.cpp</div>
<div class="line"><a class="code hl_function" href="mitkKinectDeviceTest_8cpp.html#ac5dde44355e6595923aa948e8f049c3a">mitkKinectDeviceTest</a>.cpp</div>
<div class="line">)</div>
<div class="ttc" id="amitkKinectControllerTest_8cpp_html_a88962bc6795136a50957a8d5450b52f1"><div class="ttname"><a href="mitkKinectControllerTest_8cpp.html#a88962bc6795136a50957a8d5450b52f1">mitkKinectControllerTest</a></div><div class="ttdeci">int mitkKinectControllerTest(int, char *[])</div><div class="ttdef"><b>Definition</b> <a href="mitkKinectControllerTest_8cpp_source.html#l00019">mitkKinectControllerTest.cpp:19</a></div></div>
<div class="ttc" id="amitkKinectDeviceTest_8cpp_html_ac5dde44355e6595923aa948e8f049c3a"><div class="ttname"><a href="mitkKinectDeviceTest_8cpp.html#ac5dde44355e6595923aa948e8f049c3a">mitkKinectDeviceTest</a></div><div class="ttdeci">int mitkKinectDeviceTest(int, char *[])</div><div class="ttdef"><b>Definition</b> <a href="mitkKinectDeviceTest_8cpp_source.html#l00019">mitkKinectDeviceTest.cpp:19</a></div></div>
</div><!-- fragment --><p>As before, feel free to take a look at one of the existing Modules and their Testing-Subfolder as the Kinect´s.</p>
<p>If you managed to implement your Module properly, an executable MODULENAMETestDriver will be generated. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="mitkigt.html">MITK-IGT</a></li><li class="navelem"><a class="el" href="NavigationGeneralModulePage.html">IGT Navigation Module</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0 </li>
  </ul>
</div>
</body>
</html>
