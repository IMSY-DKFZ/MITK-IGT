<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MITK-IGT: IGT filter pipeline</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">MITK-IGT
   </div>
   <div id="projectbrief">IGT Extension of MITK</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('IGTTutorialStepFilterPipeline.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">IGT filter pipeline</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The IGT tutorial consists of four main parts for construction of a small navigation pipeline using a virtual tracking device. The virtual tracking device produces random tool data (position and orientation) so no additional hardware is required. The full code of this small navigation pipeline included in this tutorial can be found in MITK-Source/Modules/IGT/Tutorial/mitkIGTTutorialStep1.cpp. At the very end of this page, you can find build instructions on how to run this example on your computer.</p>
<div class="fragment"><div class="line">  <span class="comment">//*************************************************************************</span></div>
<div class="line">  <span class="comment">// What we will do...</span></div>
<div class="line">  <span class="comment">//*************************************************************************</span></div>
<div class="line">  <span class="comment">//In this tutorial we build up a small navigation pipeline with a virtual tracking device</span></div>
<div class="line">  <span class="comment">//which produce random positions and orientation so no additional hardware is required.</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">//The source of the pipeline is a TrackingDeviceSource object. This we connect to a simple</span></div>
<div class="line">  <span class="comment">//filter which just displaces the positions with an offset. After that we use a recorder</span></div>
<div class="line">  <span class="comment">//to store this new positions and other information to disc in a XML file. After that, we use</span></div>
<div class="line">  <span class="comment">//another source (NavigationDataPlayer) to replay the recorded data.</span></div>
</div><!-- fragment --><h1><a class="anchor" id="IGT_Tracking_Layer"></a>
Tracking Layer</h1>
<p>Firstly a new object "tracker" of the type <a class="el" href="classmitk_1_1VirtualTrackingDevice.html" title="Class representing a tracking device which generates random positions / orientations....">mitk::VirtualTrackingDevice</a> is created, then two tools, named "tool1" and "tool2", are added to this tracker. Since the tracking device "tracker" is treated as a virtual tracking device, tool1 and tool2 are just added to the object by method AddTool(name) and don't need further specification (e.g. real tools might need a calibration file).</p>
<div class="fragment"><div class="line">  <span class="comment">//*************************************************************************</span></div>
<div class="line">  <span class="comment">// Part I: Basic initialization of the source and tracking device</span></div>
<div class="line">  <span class="comment">//*************************************************************************</span></div>
<div class="line">  <span class="comment">//First of all create a tracking device object and two tools for this &quot;device&quot;.</span></div>
<div class="line"> </div>
<div class="line">  <span class="comment">//Here we take the VirtualTrackingDevice. This is not a real tracking device it just delivers random</span></div>
<div class="line">  <span class="comment">//positions and orientations. You can use other/real tracking devices if you replace the following</span></div>
<div class="line">  <span class="comment">//code with different tracking devices, e.g. mitk::NDITrackingDevice. The tools represent the</span></div>
<div class="line">  <span class="comment">//sensors of the tracking device. The TrackingDevice fills the tools with data.</span></div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;Generating TrackingDevice ...&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">  mitk::VirtualTrackingDevice::Pointer tracker = mitk::VirtualTrackingDevice::New();</div>
<div class="line">  tracker-&gt;AddTool(<span class="stringliteral">&quot;tool1&quot;</span>);</div>
<div class="line">  tracker-&gt;AddTool(<span class="stringliteral">&quot;tool2&quot;</span>);</div>
</div><!-- fragment --><h1><a class="anchor" id="IGT_Navigation_Layer"></a>
Navigation Layer</h1>
<div class="image">
<img src="IGTTutorialStep1.png" alt=""/>
</div>
<p> <br  />
 </p>
<p>Secondly, a new source of the type <a class="el" href="classmitk_1_1TrackingDeviceSource.html" title="Connects a mitk::TrackingDevice to a MITK-IGT NavigationData-Filterpipeline.">mitk::TrackingDeviceSource</a> has to be created with outputs for each single tool of a tracker. The source sets the following tracking device by using method SetTrackingDevice as shown below. So now, the source is initialized with the virtual tracking device. Next, the source is connected and tracking is started.</p>
<div class="fragment"><div class="line">  <span class="comment">//The tracking device object is used for the physical connection to the device. To use the</span></div>
<div class="line">  <span class="comment">//data inside of our tracking pipeline we need a source. This source encapsulate the tracking device</span></div>
<div class="line">  <span class="comment">//and provides objects of the type mitk::NavigationData as output. The NavigationData objects stores</span></div>
<div class="line">  <span class="comment">//position, orientation, if the data is valid or not and special error informations in a covariance</span></div>
<div class="line">  <span class="comment">//matrix.</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">//Typically the start of our pipeline is a TrackingDeviceSource. To work correct we have to set a</span></div>
<div class="line">  <span class="comment">//TrackingDevice object. Attention you have to set the tools before you set the whole TrackingDevice</span></div>
<div class="line">  <span class="comment">//object to the TrackingDeviceSource because the source need to know how many outputs should be</span></div>
<div class="line">  <span class="comment">//generated.</span></div>
<div class="line"> </div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;Generating Source ...&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">  mitk::TrackingDeviceSource::Pointer source = mitk::TrackingDeviceSource::New();</div>
<div class="line">  source-&gt;SetTrackingDevice(tracker); <span class="comment">//here we set the device for the pipeline source</span></div>
<div class="line"> </div>
<div class="line">  source-&gt;Connect();        <span class="comment">//here we connect to the tracking system</span></div>
<div class="line">  <span class="comment">//Note we do not call this on the TrackingDevice object</span></div>
<div class="line">  source-&gt;StartTracking();  <span class="comment">//start the tracking</span></div>
<div class="line">  <span class="comment">//Now the source generates outputs.</span></div>
</div><!-- fragment --><p>In part II, a displacemt filter (object "displacer") is constructed to change the positions of the filtered NavigationData objects with an offset for each direction (X,Y,Z). The given filter has inputs and outputs for each tool, in this example we have two tools. Hence, there exist two inputs and outputs. Every output of the displacement filter object is connected to the recorder object in the next part.</p>
<div class="fragment"><div class="line">  <span class="comment">//*************************************************************************</span></div>
<div class="line">  <span class="comment">// Part II: Create a NavigationDataToNavigationDataFilter</span></div>
<div class="line">  <span class="comment">//*************************************************************************</span></div>
<div class="line"> </div>
<div class="line">  <span class="comment">//The next thing we do is using a NavigationDataToNavigationDataFilter. One of these filter is the</span></div>
<div class="line">  <span class="comment">//very simple NavigationDataDisplacementFilter. This filter just changes the positions of the input</span></div>
<div class="line">  <span class="comment">//NavigationData objects with an offset for each direction (X,Y,Z). The input of this filter is the</span></div>
<div class="line">  <span class="comment">//source and the output of this filter is the &quot;displaced&quot; input.</span></div>
<div class="line"> </div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;Generating DisplacementFilter ...&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">  mitk::NavigationDataDisplacementFilter::Pointer displacer = mitk::NavigationDataDisplacementFilter::New();</div>
<div class="line">  mitk::Vector3D offset;</div>
<div class="line">  mitk::FillVector3D(offset, 10.0, 100.0, 1.0); <span class="comment">//initialize the offset</span></div>
<div class="line">  displacer-&gt;SetOffset(offset); <span class="comment">//now set the offset in the NavigationDataDisplacementFilter object</span></div>
<div class="line"> </div>
<div class="line">  <span class="comment">//Connect the two filters. You can use the ConnectTo method to automatically connect all outputs from one filter</span></div>
<div class="line">  <span class="comment">// to inputs from another filter.</span></div>
<div class="line">  displacer-&gt;ConnectTo(source.GetPointer());</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Alternatively, you can manually connect inputs and outputs.</span></div>
<div class="line">  <span class="comment">// The code below shows what the ConnectTo Methods does internally:</span></div>
<div class="line">  <span class="comment">//</span></div>
<div class="line">  <span class="comment">//for (unsigned int i = 0; i &lt; source-&gt;GetNumberOfOutputs(); i++)</span></div>
<div class="line">  <span class="comment">//{</span></div>
<div class="line">  <span class="comment">//  displacer-&gt;SetInput(i, source-&gt;GetOutput(i));  //here we connect to the displacement filter</span></div>
<div class="line">  <span class="comment">//}</span></div>
<div class="line"> </div>
</div><!-- fragment --><h1><a class="anchor" id="IGT_Record_Navigation_Data"></a>
Record Navigation Data</h1>
<p>In part III, all the NavigationData is recorded with the NavigationDataRecorder. In order to record, we simply create an object "recorder" of the type <a class="el" href="classmitk_1_1NavigationDataRecorder.html" title="This class records NavigationData objects into NavigationDataSets.">mitk::NavigationDataRecorder</a> and set the appropriate file to it. Now the displacer object is connected to the recorder object, the method StartRecording() is called on the next line. Afterwards, the recorder has to be updated a couple of times. In this example the recorder is updating 100 times through a for-loop statement. This can also be seen as a simulation of a timer by using a for-loop.</p>
<div class="fragment"><div class="line"> </div>
<div class="line">  <span class="comment">//*************************************************************************</span></div>
<div class="line">  <span class="comment">// Part III: Record the data with the NavigationDataRecorder</span></div>
<div class="line">  <span class="comment">//*************************************************************************</span></div>
<div class="line"> </div>
<div class="line">  <span class="comment">//The next part of our pipeline is the recorder. The input of the recorder is the output of the displacement filter</span></div>
<div class="line">  <span class="comment">//and the output is a XML file with the name &quot;Test Output-0.xml&quot;, which is written with a NavigationDataSetWriter.</span></div>
<div class="line"> </div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;Start Recording ...&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">//we need the stringstream for building up our filename</span></div>
<div class="line">  std::stringstream filename;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">//the .xml extension and an counter is NOT added automatically anymore -- that was the case in an earlier version</span></div>
<div class="line">  filename &lt;&lt; itksys::SystemTools::GetCurrentWorkingDirectory() &lt;&lt; <span class="stringliteral">&quot;/Test Output-0.xml&quot;</span>;</div>
<div class="line"> </div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;Record to file: &quot;</span> &lt;&lt; filename.str() &lt;&lt; <span class="stringliteral">&quot; ...&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">  mitk::NavigationDataRecorder::Pointer recorder = mitk::NavigationDataRecorder::New();</div>
<div class="line"> </div>
<div class="line">  <span class="comment">//now the output of the displacer object is connected to the recorder object</span></div>
<div class="line">  recorder-&gt;ConnectTo(displacer);</div>
<div class="line"> </div>
<div class="line">  recorder-&gt;StartRecording(); <span class="comment">//after finishing the settings you can start the recording mechanism</span></div>
<div class="line">  <span class="comment">//now every update of the recorder stores one line into the file for</span></div>
<div class="line">  <span class="comment">//each added NavigationData</span></div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x = 0; x &lt; 100; x++) <span class="comment">//write 100 datasets</span></div>
<div class="line">  {</div>
<div class="line">    recorder-&gt;Update(); <span class="comment">//the update causes one line in the XML file for every tool</span></div>
<div class="line">    <span class="comment">//in this case two lines</span></div>
<div class="line">    itksys::SystemTools::Delay(100);         <span class="comment">//sleep a little</span></div>
<div class="line">  }</div>
<div class="line">  recorder-&gt;StopRecording(); <span class="comment">//to get proper XML files you should stop recording</span></div>
<div class="line">  <span class="comment">//if your application crashes during recording no data</span></div>
<div class="line">  <span class="comment">//will be lost it is all stored to disc</span></div>
<div class="line"> </div>
<div class="line">  <span class="comment">//The IO-System needs a filename. Otherwise the output</span></div>
<div class="line">  <span class="comment">//is redirected to the console. See MITK-Concepts page for more details on IO in MITK</span></div>
<div class="line">  mitk::IOUtil::Save(recorder-&gt;GetNavigationDataSet(), filename.str());</div>
<div class="line"> </div>
</div><!-- fragment --><h1><a class="anchor" id="IGT_Play_Navigation_Data"></a>
Play Navigation Data</h1>
<p>Part IV explains how the recoded file can be played for further use. After the object "player" of a type <a class="el" href="classmitk_1_1NavigationDataSequentialPlayer.html" title="This class is a slightly changed reimplementation of the NavigationDataPlayer which does not care abo...">mitk::NavigationDataSequentialPlayer</a> is created, the required file has to be set to the player and playing has to be started. Here, there exists a new pipeline which functions by reading the recorded file from the harddisc and plays it by using the player as source. During the play, the for-loop makes the file update as in part III.</p>
<div class="image">
<img src="IGTTutorialStep1-2.png" alt=""/>
</div>
<p> <br  />
 </p>
<div class="fragment"><div class="line"> </div>
<div class="line">  <span class="comment">//*************************************************************************</span></div>
<div class="line">  <span class="comment">// Part IV: Play the data with the NavigationDataSequentialPlayer</span></div>
<div class="line">  <span class="comment">//*************************************************************************</span></div>
<div class="line"> </div>
<div class="line">  <span class="comment">//The recording is finished now so now we can play the data. The NavigationDataPlayer is similar</span></div>
<div class="line">  <span class="comment">//to the TrackingDevice source. It also derives from NavigationDataSource. So you can use a player</span></div>
<div class="line">  <span class="comment">//instead of a TrackingDeviceSource. The input of this player is a NavigationDataSet, which we</span></div>
<div class="line">  <span class="comment">//read with a NavigationDataReader.</span></div>
<div class="line"> </div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;Start playing from file: &quot;</span> &lt;&lt; filename.str() &lt;&lt; <span class="stringliteral">&quot; ...&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">  mitk::NavigationDataSequentialPlayer::Pointer player = mitk::NavigationDataSequentialPlayer::New();</div>
<div class="line"> </div>
<div class="line">  mitk::NavigationDataSet::Pointer naviDataSet = <span class="keyword">dynamic_cast&lt;</span><a class="code hl_class" href="classmitk_1_1NavigationDataSet.html">mitk::NavigationDataSet</a>*<span class="keyword">&gt;</span> (mitk::IOUtil::Load(filename.str())[0].GetPointer());</div>
<div class="line">  player-&gt;SetNavigationDataSet(naviDataSet);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">//From now on, the player provides NavigationDatas in a sequential order. The next position is given, as soon as &quot;update&quot; is called, so this player is not in real time.</span></div>
<div class="line">  <span class="comment">//If you need the correct time of your tracking Data, use the NavigationDataPlayer instead and call &quot;StartPlaying&quot; and &quot;StopPlaying&quot;.</span></div>
<div class="line"> </div>
<div class="line">  <span class="comment">//this connects the outputs of the player to the NavigationData objects</span></div>
<div class="line">  mitk::NavigationData::Pointer nd = player-&gt;GetOutput();</div>
<div class="line">  mitk::NavigationData::Pointer nd2 = player-&gt;GetOutput(1);</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x = 0; x &lt; 100; x++)</div>
<div class="line">  {</div>
<div class="line">    <span class="keywordflow">if</span> (nd.IsNotNull()) <span class="comment">//check if the output is not null</span></div>
<div class="line">    {</div>
<div class="line">      <span class="comment">//With this call, we go to the next recorded data set.</span></div>
<div class="line">      player-&gt;GoToNextSnapshot();</div>
<div class="line"> </div>
<div class="line">      MITK_INFO &lt;&lt; <span class="stringliteral">&quot;Time Step &quot;</span> &lt;&lt; x;</div>
<div class="line">      MITK_INFO &lt;&lt; <span class="stringliteral">&quot;Tool 1:&quot;</span> &lt;&lt; nd-&gt;GetPosition();</div>
<div class="line">      MITK_INFO &lt;&lt; <span class="stringliteral">&quot;Tool 2:&quot;</span> &lt;&lt; nd2-&gt;GetPosition();</div>
<div class="line"> </div>
<div class="line">      itksys::SystemTools::Delay(100); <span class="comment">//sleep a little like in the recorder part, just for nice reading...</span></div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  itksys::SystemTools::Delay(2000);</div>
<div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;finished&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"> </div>
</div><!-- fragment --><h1><a class="anchor" id="IGTTutStep1Build"></a>
IGT Example Build Instructions</h1>
<p>This tutorial is an extra target which can be build separately. Make sure, you selected the Navigation option in cmake during your superbuild (set MITK_BUILD_CONFIGURATION to mitkNavigation modules) or select the MITK_BUILD_org.mitk.gui.qt.igtexamples on your MITK-build and make sure that all dependencies are build.</p>
<p><b> Visual Studio: </b> Right click in your solution explorer on MITKIGTTutorialStep1 --&gt; Set as start up project --&gt; build &amp; Start without debugging. <a class="el" href="classA.html">A</a> new window will open. </p><div class="image">
<img src="IGTTutorialStep1_buildInstrWindows.png" alt=""/>
</div>
<p> <br  />
 </p>
<p><b> Qt creator: </b> Select MITKIGTTutorialStep1 as Project (see screenshot below) and build and run the project. The output can be found in the QT creator console. </p><div class="image">
<img src="IGTTutorialStep1_buildInstrLinux.png" alt=""/>
</div>
<p> <br  />
 </p>
<p>Your output should look similar to this:</p>
<div class="image">
<img src="IGTTutorialStep1_output.png" alt=""/>
</div>
<p> <br  />
 </p>
<p>Return to the <a class="el" href="IGTTutorialOverview.html">[IGT Tutorial Overview]</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="mitkigt.html">MITK-IGT</a></li><li class="navelem"><a class="el" href="IGTTutorialOverview.html">IGT Tutorial Overview</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0 </li>
  </ul>
</div>
</body>
</html>
