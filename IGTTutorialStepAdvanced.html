<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MITK-IGT: A deeper look into the IGT Plugins</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">MITK-IGT
   </div>
   <div id="projectbrief">IGT Extension of MITK</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('IGTTutorialStepAdvanced.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">A deeper look into the IGT Plugins</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>We already know the three views of the IGT tracking plugin from the first tutorial step (<a class="el" href="org_mitk_gui_qt_igttracking.html">The IGT Tracking Plugin</a>): <a class="el" href="org_mitk_views_igttrackingtoolbox.html">The MITK-IGT Tracking Toolbox</a> , <a class="el" href="org_mitk_views_igtnavigationtoolmanager.html">The MITK-IGT Navigation Tool Manager</a> and <a class="el" href="org_mitk_views_navigationdataplayer.html">The NavigationData Player</a> . While the first tutorial step only dealt with the usage of these views, we now want to have a deeper look at some parts of the code.</p>
<h1><a class="anchor" id="Widgets"></a>
IGT Widgets</h1>
<p><a class="el" href="classA.html">A</a> lot of the IGT functionality is available as a widget. So if you need some part of it for your own plugin, you might just want to include the widget. This is for example done for the <a class="el" href="classQmitkNavigationToolCreationWidget.html" title="An object of this class offers an UI to create or modify NavigationTools.">QmitkNavigationToolCreationWidget</a>, which is used in the <a class="el" href="org_mitk_views_igttrackingtoolbox.html">The MITK-IGT Tracking Toolbox</a> view as well as in the <a class="el" href="org_mitk_views_igtnavigationtoolmanager.html">The MITK-IGT Navigation Tool Manager</a> view.</p>
<div class="image">
<img src="IGTTutorialStep5_Widgets.png" alt=""/>
</div>
<p> <br  />
 </p>
<h1><a class="anchor" id="DataAccess"></a>
Data access</h1>
<p>The fist important question is, how to get the tools you want to use for your application. The most simple way is using the <a class="el" href="org_mitk_views_igtnavigationtoolmanager.html">The MITK-IGT Navigation Tool Manager</a> to load, create or edit the tools and access it via the NavigationToolStorage. It's provided by a microservice and you can access it e.g. via the module context (make sure, your module depends on IGT): </p><pre class="fragment">  us::ModuleContext* context = us::GetModuleContext();
  std::vector&lt;us::ServiceReference &lt;mitk::NavigationToolStorage&gt; &gt; refs = context-&gt;GetServiceReferences&lt;mitk::NavigationToolStorage&gt;();
  m_ToolStorage = context-&gt;GetService&lt;mitk::NavigationToolStorage&gt;(refs.front());
</pre><p>Then, simply access the tools by </p><pre class="fragment">  m_ToolStorage-&gt;GetTool();
</pre><p>There are also many different functions available, e.g. providing the number of available tools or the name of the current tracking device. Just have a look at the documentation of the <a class="el" href="classmitk_1_1NavigationToolStorage.html" title="An object of this class represents a collection of navigation tools. You may add/delete navigation to...">mitk::NavigationToolStorage</a> if you are interested in it.</p>
<h1><a class="anchor" id="AutoLoad"></a>
Autoload all parameters from last session</h1>
<p>To increase the usability of the application, the tracking toolbox restores all parameters from the last session. Therefore, we will use the following code to save all parameters. It is also used in the specific tracking device widgets, but we will just have a look at one example, restoring some parameters like the Show-Tracking-Volume-Checkbox, the filename of the autosave path of the tool storage or the index of the tracking volume.</p>
<p>To store the settings, the following code is used:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="classQmitkMITKIGTTrackingToolboxView.html#a2036128bfe8b945b99fc121195aac1fa">QmitkMITKIGTTrackingToolboxView::StoreUISettings</a>()</div>
<div class="line">{</div>
<div class="line">  <span class="comment">// persistence service does not directly work in plugins for now</span></div>
<div class="line">  <span class="comment">// -&gt; using QSettings</span></div>
<div class="line">  QSettings settings;</div>
<div class="line"> </div>
<div class="line">  settings.beginGroup(QString::fromStdString(<a class="code hl_variable" href="classQmitkMITKIGTTrackingToolboxView.html#ada06d752112f3fd37d598172cac29abd">VIEW_ID</a>));</div>
<div class="line">  MITK_DEBUG &lt;&lt; <span class="stringliteral">&quot;Store UI settings&quot;</span>;</div>
<div class="line">  <span class="comment">// set the values of some widgets and attributes to the QSettings</span></div>
<div class="line">  settings.setValue(<span class="stringliteral">&quot;ShowTrackingVolume&quot;</span>, QVariant(<a class="code hl_variable" href="classQmitkMITKIGTTrackingToolboxView.html#a8b2a1f6180f9345e8291d8ac394d684c">m_Controls</a>-&gt;m_ShowTrackingVolume-&gt;isChecked()));</div>
<div class="line">  settings.setValue(<span class="stringliteral">&quot;toolStorageFilename&quot;</span>, QVariant(<a class="code hl_variable" href="classQmitkMITKIGTTrackingToolboxView.html#afe6b58fc862ff38a7be892b09026cda2">m_ToolStorageFilename</a>));</div>
<div class="line">  settings.setValue(<span class="stringliteral">&quot;VolumeSelectionBox&quot;</span>, QVariant(<a class="code hl_variable" href="classQmitkMITKIGTTrackingToolboxView.html#a8b2a1f6180f9345e8291d8ac394d684c">m_Controls</a>-&gt;m_VolumeSelectionBox-&gt;currentIndex()));</div>
<div class="line">  settings.setValue(<span class="stringliteral">&quot;SimpleModeEnabled&quot;</span>, QVariant(<a class="code hl_variable" href="classQmitkMITKIGTTrackingToolboxView.html#a7c401b4ec01d037ab6c5a196c0a7cac7">m_SimpleModeEnabled</a>));</div>
<div class="line">  settings.setValue(<span class="stringliteral">&quot;OpenIGTLinkDataFormat&quot;</span>, QVariant(<a class="code hl_variable" href="classQmitkMITKIGTTrackingToolboxView.html#a8b2a1f6180f9345e8291d8ac394d684c">m_Controls</a>-&gt;m_OpenIGTLinkDataFormat-&gt;currentIndex()));</div>
<div class="line">  settings.setValue(<span class="stringliteral">&quot;EnableOpenIGTLinkMicroService&quot;</span>, QVariant(<a class="code hl_variable" href="classQmitkMITKIGTTrackingToolboxView.html#a8b2a1f6180f9345e8291d8ac394d684c">m_Controls</a>-&gt;m_EnableOpenIGTLinkMicroService-&gt;isChecked()));</div>
<div class="line">  settings.endGroup();</div>
<div class="line">}</div>
</div><!-- fragment --><p>We will reload it with </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="classQmitkMITKIGTTrackingToolboxView.html#a658332705f6ce03f5a2d00e45472f0d1">QmitkMITKIGTTrackingToolboxView::LoadUISettings</a>()</div>
<div class="line">{</div>
<div class="line">  <span class="comment">// persistence service does not directly work in plugins for now -&gt; using QSettings</span></div>
<div class="line">  QSettings settings;</div>
<div class="line"> </div>
<div class="line">  settings.beginGroup(QString::fromStdString(<a class="code hl_variable" href="classQmitkMITKIGTTrackingToolboxView.html#ada06d752112f3fd37d598172cac29abd">VIEW_ID</a>));</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// set some widgets and attributes by the values from the QSettings</span></div>
<div class="line">  <a class="code hl_variable" href="classQmitkMITKIGTTrackingToolboxView.html#a8b2a1f6180f9345e8291d8ac394d684c">m_Controls</a>-&gt;m_ShowTrackingVolume-&gt;setChecked(settings.value(<span class="stringliteral">&quot;ShowTrackingVolume&quot;</span>, <span class="keyword">false</span>).toBool());</div>
<div class="line">  <a class="code hl_variable" href="classQmitkMITKIGTTrackingToolboxView.html#a8b2a1f6180f9345e8291d8ac394d684c">m_Controls</a>-&gt;m_EnableOpenIGTLinkMicroService-&gt;setChecked(settings.value(<span class="stringliteral">&quot;EnableOpenIGTLinkMicroService&quot;</span>, <span class="keyword">true</span>).toBool());</div>
<div class="line">  <a class="code hl_variable" href="classQmitkMITKIGTTrackingToolboxView.html#a8b2a1f6180f9345e8291d8ac394d684c">m_Controls</a>-&gt;m_VolumeSelectionBox-&gt;setCurrentIndex(settings.value(<span class="stringliteral">&quot;VolumeSelectionBox&quot;</span>, 0).toInt());</div>
<div class="line">  <a class="code hl_variable" href="classQmitkMITKIGTTrackingToolboxView.html#a8b2a1f6180f9345e8291d8ac394d684c">m_Controls</a>-&gt;m_OpenIGTLinkDataFormat-&gt;setCurrentIndex(settings.value(<span class="stringliteral">&quot;OpenIGTLinkDataFormat&quot;</span>, 0).toInt());</div>
<div class="line">  <a class="code hl_variable" href="classQmitkMITKIGTTrackingToolboxView.html#afe6b58fc862ff38a7be892b09026cda2">m_ToolStorageFilename</a> = settings.value(<span class="stringliteral">&quot;toolStorageFilename&quot;</span>, QVariant(<span class="stringliteral">&quot;&quot;</span>)).toString();</div>
<div class="line">  <span class="keywordflow">if</span> (settings.value(<span class="stringliteral">&quot;SimpleModeEnabled&quot;</span>, <span class="keyword">false</span>).toBool()) { this-&gt;<a class="code hl_slot" href="classQmitkMITKIGTTrackingToolboxView.html#ab66ce8cbcbe448828956bef80240af6d">OnToggleAdvancedSimpleMode</a>(); }</div>
<div class="line">  settings.endGroup();</div>
</div><!-- fragment --><h1><a class="anchor" id="LoadToolStorage"></a>
Load Tool Storage</h1>
<p>This code will load a previously stored or autosaved tool storage:</p>
<div class="fragment"><div class="line">  <span class="comment">// try to deserialize the tool storage from the given tool storage file name</span></div>
<div class="line">  <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classQmitkMITKIGTTrackingToolboxView.html#afe6b58fc862ff38a7be892b09026cda2">m_ToolStorageFilename</a>.isEmpty())</div>
<div class="line">  {</div>
<div class="line">    <span class="comment">// try-catch block for exceptions</span></div>
<div class="line">    <span class="keywordflow">try</span></div>
<div class="line">    {</div>
<div class="line">      mitk::NavigationToolStorageDeserializer::Pointer myDeserializer = mitk::NavigationToolStorageDeserializer::New(GetDataStorage());</div>
<div class="line">      <a class="code hl_variable" href="classQmitkMITKIGTTrackingToolboxView.html#ab781bfaa8e0ae41a793a57e74186951b">m_toolStorage</a>-&gt;UnRegisterMicroservice();</div>
<div class="line">      <a class="code hl_variable" href="classQmitkMITKIGTTrackingToolboxView.html#ab781bfaa8e0ae41a793a57e74186951b">m_toolStorage</a> = myDeserializer-&gt;Deserialize(<a class="code hl_variable" href="classQmitkMITKIGTTrackingToolboxView.html#afe6b58fc862ff38a7be892b09026cda2">m_ToolStorageFilename</a>.toStdString());</div>
<div class="line">      <a class="code hl_variable" href="classQmitkMITKIGTTrackingToolboxView.html#ab781bfaa8e0ae41a793a57e74186951b">m_toolStorage</a>-&gt;RegisterAsMicroservice();</div>
<div class="line"> </div>
<div class="line">      <span class="comment">//update label</span></div>
<div class="line">      <a class="code hl_function" href="classQmitkMITKIGTTrackingToolboxView.html#a141e3ad6c5d5e5e9aebf0d2d95dfdb89">UpdateToolStorageLabel</a>(<a class="code hl_variable" href="classQmitkMITKIGTTrackingToolboxView.html#afe6b58fc862ff38a7be892b09026cda2">m_ToolStorageFilename</a>);</div>
<div class="line"> </div>
<div class="line">      <span class="comment">//update tool preview</span></div>
<div class="line">      <a class="code hl_variable" href="classQmitkMITKIGTTrackingToolboxView.html#a8b2a1f6180f9345e8291d8ac394d684c">m_Controls</a>-&gt;m_TrackingToolsStatusWidget-&gt;RemoveStatusLabels();</div>
<div class="line">      <a class="code hl_variable" href="classQmitkMITKIGTTrackingToolboxView.html#a8b2a1f6180f9345e8291d8ac394d684c">m_Controls</a>-&gt;m_TrackingToolsStatusWidget-&gt;PreShowTools(<a class="code hl_variable" href="classQmitkMITKIGTTrackingToolboxView.html#ab781bfaa8e0ae41a793a57e74186951b">m_toolStorage</a>);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">catch</span> (<span class="keyword">const</span> <a class="code hl_class" href="classmitk_1_1IGTException.html">mitk::IGTException</a>&amp; e)</div>
<div class="line">    {</div>
<div class="line">      MITK_WARN(<span class="stringliteral">&quot;QmitkMITKIGTTrackingToolBoxView&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;Error during restoring tools. Problems with file (&quot;</span> &lt;&lt; <a class="code hl_variable" href="classQmitkMITKIGTTrackingToolboxView.html#afe6b58fc862ff38a7be892b09026cda2">m_ToolStorageFilename</a>.toStdString() &lt;&lt; <span class="stringliteral">&quot;), please check the file? Error message: &quot;</span>&lt;&lt;e.GetDescription();</div>
<div class="line">      this-&gt;<a class="code hl_slot" href="classQmitkMITKIGTTrackingToolboxView.html#acaaf838b062f4d3cd76c423caa2d9432">OnResetTools</a>(); <span class="comment">//if there where errors reset the tool storage to avoid problems later on</span></div>
<div class="line">    }</div>
<div class="line">  }</div>
</div><!-- fragment --><h1><a class="anchor" id="ThreadedTracking"></a>
Threaded Tracking</h1>
<p>Usually, the tracking is done in a separate thread in order to still allow parallel usage of the workbench. If we track the devices in the same thread, the workbench might freeze. That's why we use thread workers </p><div class="fragment"><div class="line">  <span class="comment">//initialize worker thread</span></div>
<div class="line">  m_WorkerThread = <span class="keyword">new</span> QThread();</div>
<div class="line">  m_Worker = <span class="keyword">new</span> <a class="code hl_class" href="classQmitkMITKIGTTrackingToolboxViewWorker.html">QmitkMITKIGTTrackingToolboxViewWorker</a>();</div>
</div><!-- fragment --><p> ...which are connected to functions </p><div class="fragment"><div class="line">    <span class="comment">//connect worker thread</span></div>
<div class="line">    connect(<a class="code hl_variable" href="classQmitkMITKIGTTrackingToolboxView.html#a9fe9ea3d8d3f6fc4b9fdec86f28ffbab">m_Worker</a>, SIGNAL(AutoDetectToolsFinished(<span class="keywordtype">bool</span>, QString)), <span class="keyword">this</span>, SLOT(<a class="code hl_slot" href="classQmitkMITKIGTTrackingToolboxView.html#a6a48fbcc6727cc333173fcfce7143919">OnAutoDetectToolsFinished</a>(<span class="keywordtype">bool</span>, QString)));</div>
<div class="line">    connect(<a class="code hl_variable" href="classQmitkMITKIGTTrackingToolboxView.html#a9fe9ea3d8d3f6fc4b9fdec86f28ffbab">m_Worker</a>, SIGNAL(ConnectDeviceFinished(<span class="keywordtype">bool</span>, QString)), <span class="keyword">this</span>, SLOT(<a class="code hl_slot" href="classQmitkMITKIGTTrackingToolboxView.html#a9d64fc114b56b10524528c323a0e91fe">OnConnectFinished</a>(<span class="keywordtype">bool</span>, QString)));</div>
<div class="line">    connect(<a class="code hl_variable" href="classQmitkMITKIGTTrackingToolboxView.html#a9fe9ea3d8d3f6fc4b9fdec86f28ffbab">m_Worker</a>, SIGNAL(StartTrackingFinished(<span class="keywordtype">bool</span>, QString)), <span class="keyword">this</span>, SLOT(<a class="code hl_slot" href="classQmitkMITKIGTTrackingToolboxView.html#a3272696914de1009cd56f3a69a8b50c6">OnStartTrackingFinished</a>(<span class="keywordtype">bool</span>, QString)));</div>
<div class="line">    connect(<a class="code hl_variable" href="classQmitkMITKIGTTrackingToolboxView.html#a9fe9ea3d8d3f6fc4b9fdec86f28ffbab">m_Worker</a>, SIGNAL(StopTrackingFinished(<span class="keywordtype">bool</span>, QString)), <span class="keyword">this</span>, SLOT(<a class="code hl_slot" href="classQmitkMITKIGTTrackingToolboxView.html#a835c6548c855271f2cf601d781bb9e86">OnStopTrackingFinished</a>(<span class="keywordtype">bool</span>, QString)));</div>
<div class="line">    connect(<a class="code hl_variable" href="classQmitkMITKIGTTrackingToolboxView.html#a9fe9ea3d8d3f6fc4b9fdec86f28ffbab">m_Worker</a>, SIGNAL(DisconnectDeviceFinished(<span class="keywordtype">bool</span>, QString)), <span class="keyword">this</span>, SLOT(<a class="code hl_slot" href="classQmitkMITKIGTTrackingToolboxView.html#a819f50e54dace1af4af71cfb3b1fbd0e">OnDisconnectFinished</a>(<span class="keywordtype">bool</span>, QString)));</div>
<div class="line">    connect(<a class="code hl_variable" href="classQmitkMITKIGTTrackingToolboxView.html#ae47929a49d70d4a6b6e3adc67c214b46">m_WorkerThread</a>, SIGNAL(started()), <a class="code hl_variable" href="classQmitkMITKIGTTrackingToolboxView.html#a9fe9ea3d8d3f6fc4b9fdec86f28ffbab">m_Worker</a>, SLOT(ThreadFunc()));</div>
<div class="line"> </div>
<div class="line">    connect(<a class="code hl_variable" href="classQmitkMITKIGTTrackingToolboxView.html#a9fe9ea3d8d3f6fc4b9fdec86f28ffbab">m_Worker</a>, SIGNAL(ConnectDeviceFinished(<span class="keywordtype">bool</span>, QString)), <a class="code hl_variable" href="classQmitkMITKIGTTrackingToolboxView.html#a8b2a1f6180f9345e8291d8ac394d684c">m_Controls</a>-&gt;m_ConfigurationWidget, SLOT(OnConnected(<span class="keywordtype">bool</span>)));</div>
<div class="line">    connect(<a class="code hl_variable" href="classQmitkMITKIGTTrackingToolboxView.html#a9fe9ea3d8d3f6fc4b9fdec86f28ffbab">m_Worker</a>, SIGNAL(DisconnectDeviceFinished(<span class="keywordtype">bool</span>, QString)), <a class="code hl_variable" href="classQmitkMITKIGTTrackingToolboxView.html#a8b2a1f6180f9345e8291d8ac394d684c">m_Controls</a>-&gt;m_ConfigurationWidget, SLOT(OnDisconnected(<span class="keywordtype">bool</span>)));</div>
<div class="line">    connect(<a class="code hl_variable" href="classQmitkMITKIGTTrackingToolboxView.html#a9fe9ea3d8d3f6fc4b9fdec86f28ffbab">m_Worker</a>, SIGNAL(StartTrackingFinished(<span class="keywordtype">bool</span>, QString)), <a class="code hl_variable" href="classQmitkMITKIGTTrackingToolboxView.html#a8b2a1f6180f9345e8291d8ac394d684c">m_Controls</a>-&gt;m_ConfigurationWidget, SLOT(<a class="code hl_slot" href="classQmitkMITKIGTTrackingToolboxView.html#a01312bf93248c876e7d2f8db476a8b5c">OnStartTracking</a>(<span class="keywordtype">bool</span>)));</div>
<div class="line">    connect(<a class="code hl_variable" href="classQmitkMITKIGTTrackingToolboxView.html#a9fe9ea3d8d3f6fc4b9fdec86f28ffbab">m_Worker</a>, SIGNAL(StopTrackingFinished(<span class="keywordtype">bool</span>, QString)), <a class="code hl_variable" href="classQmitkMITKIGTTrackingToolboxView.html#a8b2a1f6180f9345e8291d8ac394d684c">m_Controls</a>-&gt;m_ConfigurationWidget, SLOT(<a class="code hl_slot" href="classQmitkMITKIGTTrackingToolboxView.html#ad45d390357c25991009ecb6c0a37d880">OnStopTracking</a>(<span class="keywordtype">bool</span>)));</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="comment">//Add Listener, so that we know when the toolStorage changed.</span></div>
<div class="line">    std::string m_Filter = <span class="stringliteral">&quot;(&quot;</span> + us::ServiceConstants::OBJECTCLASS() + <span class="stringliteral">&quot;=&quot;</span> + <span class="stringliteral">&quot;org.mitk.services.NavigationToolStorage&quot;</span> + <span class="stringliteral">&quot;)&quot;</span>;</div>
<div class="line">    <a class="code hl_function" href="classmitk_1_1org__mbi__gui__qt__usnavigation__Activator.html#aa0cca9e0384e9b07e7eb034ad9678fff">mitk::PluginActivator::GetContext</a>()-&gt;connectServiceListener(<span class="keyword">this</span>, <span class="stringliteral">&quot;OnToolStorageChanged&quot;</span>, QString(m_Filter.c_str()));</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//move the worker to the thread</span></div>
<div class="line">    <a class="code hl_variable" href="classQmitkMITKIGTTrackingToolboxView.html#a9fe9ea3d8d3f6fc4b9fdec86f28ffbab">m_Worker</a>-&gt;moveToThread(<a class="code hl_variable" href="classQmitkMITKIGTTrackingToolboxView.html#ae47929a49d70d4a6b6e3adc67c214b46">m_WorkerThread</a>);</div>
</div><!-- fragment --><p>The thread will be startet, if we connect a tracking device by pushing the connect button or start tracking etc: </p><div class="fragment"><div class="line">  <span class="comment">//initialize worker thread</span></div>
<div class="line">  <a class="code hl_variable" href="classQmitkMITKIGTTrackingToolboxView.html#a9fe9ea3d8d3f6fc4b9fdec86f28ffbab">m_Worker</a>-&gt;<a class="code hl_function" href="classQmitkMITKIGTTrackingToolboxViewWorker.html#a50c2b7135221d365dc6a657f633f6739">SetWorkerMethod</a>(<a class="code hl_enumvalue" href="classQmitkMITKIGTTrackingToolboxViewWorker.html#ad3381490fcddbb9e6f029f5db10b0ff8a5b9d9cf6a0c96dc36fd04768bb54a013">QmitkMITKIGTTrackingToolboxViewWorker::eConnectDevice</a>);</div>
<div class="line">  <a class="code hl_variable" href="classQmitkMITKIGTTrackingToolboxView.html#a9fe9ea3d8d3f6fc4b9fdec86f28ffbab">m_Worker</a>-&gt;<a class="code hl_function" href="classQmitkMITKIGTTrackingToolboxViewWorker.html#a0880ec04251fb63c4c87e75a708fd0ce">SetTrackingDevice</a>(this-&gt;<a class="code hl_variable" href="classQmitkMITKIGTTrackingToolboxView.html#a8b2a1f6180f9345e8291d8ac394d684c">m_Controls</a>-&gt;m_ConfigurationWidget-&gt;GetTrackingDevice());</div>
<div class="line">  <a class="code hl_variable" href="classQmitkMITKIGTTrackingToolboxView.html#a9fe9ea3d8d3f6fc4b9fdec86f28ffbab">m_Worker</a>-&gt;<a class="code hl_function" href="classQmitkMITKIGTTrackingToolboxViewWorker.html#a2aa347dd3a702d579b92914c3020995e">SetInverseMode</a>(<a class="code hl_variable" href="classQmitkMITKIGTTrackingToolboxView.html#a8b2a1f6180f9345e8291d8ac394d684c">m_Controls</a>-&gt;m_InverseMode-&gt;isChecked());</div>
<div class="line">  <a class="code hl_variable" href="classQmitkMITKIGTTrackingToolboxView.html#a9fe9ea3d8d3f6fc4b9fdec86f28ffbab">m_Worker</a>-&gt;<a class="code hl_function" href="classQmitkMITKIGTTrackingToolboxViewWorker.html#a67381e139f1b54ac8c23df0140aa6dfe">SetNavigationToolStorage</a>(this-&gt;<a class="code hl_variable" href="classQmitkMITKIGTTrackingToolboxView.html#ab781bfaa8e0ae41a793a57e74186951b">m_toolStorage</a>);</div>
<div class="line">  <a class="code hl_variable" href="classQmitkMITKIGTTrackingToolboxView.html#a9fe9ea3d8d3f6fc4b9fdec86f28ffbab">m_Worker</a>-&gt;<a class="code hl_function" href="classQmitkMITKIGTTrackingToolboxViewWorker.html#aa685d6e0641ef6a3ae60aae5f875373a">SetTrackingDeviceData</a>(data);</div>
<div class="line">  <span class="comment">//start worker thread</span></div>
<div class="line">  <a class="code hl_variable" href="classQmitkMITKIGTTrackingToolboxView.html#ae47929a49d70d4a6b6e3adc67c214b46">m_WorkerThread</a>-&gt;start();</div>
</div><!-- fragment --><p>...and finished afterwards: </p><div class="fragment"><div class="line">  <a class="code hl_variable" href="classQmitkMITKIGTTrackingToolboxView.html#ae47929a49d70d4a6b6e3adc67c214b46">m_WorkerThread</a>-&gt;quit();</div>
<div class="line">  <a class="code hl_variable" href="classQmitkMITKIGTTrackingToolboxView.html#ae47929a49d70d4a6b6e3adc67c214b46">m_WorkerThread</a>-&gt;wait();</div>
</div><!-- fragment --><p>You can access the data from the worker thread if needed: </p><div class="fragment"><div class="line">  <span class="comment">//get data from worker thread</span></div>
<div class="line">  <a class="code hl_variable" href="classQmitkMITKIGTTrackingToolboxView.html#a12367334f50aec808691197ab91da298">m_TrackingDeviceData</a> = <a class="code hl_variable" href="classQmitkMITKIGTTrackingToolboxView.html#a9fe9ea3d8d3f6fc4b9fdec86f28ffbab">m_Worker</a>-&gt;GetTrackingDeviceData();</div>
<div class="line">  <a class="code hl_variable" href="classQmitkMITKIGTTrackingToolboxView.html#a377491cd8c1d0e10bf4f38903486610c">m_ToolVisualizationFilter</a> = <a class="code hl_variable" href="classQmitkMITKIGTTrackingToolboxView.html#a9fe9ea3d8d3f6fc4b9fdec86f28ffbab">m_Worker</a>-&gt;GetToolVisualizationFilter();</div>
<div class="line">  <span class="keywordflow">if</span>( <a class="code hl_variable" href="classQmitkMITKIGTTrackingToolboxView.html#a377491cd8c1d0e10bf4f38903486610c">m_ToolVisualizationFilter</a>.IsNotNull() )</div>
<div class="line">  {</div>
<div class="line">    <span class="comment">//Connect the NeedleProjectionFilter to the ToolVisualizationFilter as third filter of the IGT pipeline</span></div>
<div class="line">    <a class="code hl_variable" href="classQmitkMITKIGTTrackingToolboxView.html#af4c1300b9f154491a768c7b8b003626b">m_NeedleProjectionFilter</a>-&gt;ConnectTo(<a class="code hl_variable" href="classQmitkMITKIGTTrackingToolboxView.html#a377491cd8c1d0e10bf4f38903486610c">m_ToolVisualizationFilter</a>);</div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classQmitkMITKIGTTrackingToolboxView.html#a8b2a1f6180f9345e8291d8ac394d684c">m_Controls</a>-&gt;showHideToolProjectionCheckBox-&gt;isChecked())</div>
<div class="line">    {</div>
<div class="line">      <a class="code hl_function" href="classQmitkMITKIGTTrackingToolboxView.html#aac795e9a0e3b8d81673720a1220974a1">ShowToolProjection</a>(<a class="code hl_variable" href="classQmitkMITKIGTTrackingToolboxView.html#a8b2a1f6180f9345e8291d8ac394d684c">m_Controls</a>-&gt;m_toolselector-&gt;currentIndex());</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"> </div>
</div><!-- fragment --><p>Which of the functions is finally executed will be chosen in the ThreadFunc: </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code hl_slot" href="classQmitkMITKIGTTrackingToolboxViewWorker.html#a048924aa1f1648107958e215b2f0feaf">QmitkMITKIGTTrackingToolboxViewWorker::ThreadFunc</a>()</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">switch</span> (<a class="code hl_variable" href="classQmitkMITKIGTTrackingToolboxViewWorker.html#a1d7c79495e352815204d09b984d2ff71">m_WorkerMethod</a>)</div>
<div class="line">  {</div>
<div class="line">  <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classQmitkMITKIGTTrackingToolboxViewWorker.html#ad3381490fcddbb9e6f029f5db10b0ff8a5b0154b366250d5b30f3f46ec083ea00">eAutoDetectTools</a>:</div>
<div class="line">    this-&gt;<a class="code hl_function" href="classQmitkMITKIGTTrackingToolboxViewWorker.html#a9e8d9e484614d717326127b21dfb5ae4">AutoDetectTools</a>();</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line">  <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classQmitkMITKIGTTrackingToolboxViewWorker.html#ad3381490fcddbb9e6f029f5db10b0ff8a5b9d9cf6a0c96dc36fd04768bb54a013">eConnectDevice</a>:</div>
<div class="line">    this-&gt;<a class="code hl_function" href="classQmitkMITKIGTTrackingToolboxViewWorker.html#a64c20d1714bb7bf3da88b36c54298cc6">ConnectDevice</a>();</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line">  <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classQmitkMITKIGTTrackingToolboxViewWorker.html#ad3381490fcddbb9e6f029f5db10b0ff8a315c13df8d16774d02861d20d564b491">eStartTracking</a>:</div>
<div class="line">    this-&gt;<a class="code hl_function" href="classQmitkMITKIGTTrackingToolboxViewWorker.html#ac1b05dadf2060801fbb7236ef4072bb9">StartTracking</a>();</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line">  <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classQmitkMITKIGTTrackingToolboxViewWorker.html#ad3381490fcddbb9e6f029f5db10b0ff8acf5e03248ba90571f763117512048dd7">eStopTracking</a>:</div>
<div class="line">    this-&gt;<a class="code hl_function" href="classQmitkMITKIGTTrackingToolboxViewWorker.html#abf89b3a54ebf5434cf48de3194bda150">StopTracking</a>();</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line">  <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classQmitkMITKIGTTrackingToolboxViewWorker.html#ad3381490fcddbb9e6f029f5db10b0ff8a4327c1bc5aa786807cbe7f08508d2b45">eDisconnectDevice</a>:</div>
<div class="line">    this-&gt;<a class="code hl_function" href="classQmitkMITKIGTTrackingToolboxViewWorker.html#af3e278aac2aa1f3cb92cafabc4c18b82">DisconnectDevice</a>();</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line">  <span class="keywordflow">default</span>:</div>
<div class="line">    MITK_WARN &lt;&lt; <span class="stringliteral">&quot;Undefined worker method was set ... something went wrong!&quot;</span>;</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><p>To deconstruct the workers, we first terminate the threads and then delete them </p><div class="fragment"><div class="line">    <span class="comment">// wait for thread to finish</span></div>
<div class="line">    <a class="code hl_variable" href="classQmitkMITKIGTTrackingToolboxView.html#ae47929a49d70d4a6b6e3adc67c214b46">m_WorkerThread</a>-&gt;terminate();</div>
<div class="line">    <a class="code hl_variable" href="classQmitkMITKIGTTrackingToolboxView.html#ae47929a49d70d4a6b6e3adc67c214b46">m_WorkerThread</a>-&gt;wait();</div>
<div class="line">    <span class="comment">//clean up worker thread</span></div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classQmitkMITKIGTTrackingToolboxView.html#ae47929a49d70d4a6b6e3adc67c214b46">m_WorkerThread</a>) { <span class="keyword">delete</span> <a class="code hl_variable" href="classQmitkMITKIGTTrackingToolboxView.html#ae47929a49d70d4a6b6e3adc67c214b46">m_WorkerThread</a>; }</div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classQmitkMITKIGTTrackingToolboxView.html#a9fe9ea3d8d3f6fc4b9fdec86f28ffbab">m_Worker</a>) { <span class="keyword">delete</span> <a class="code hl_variable" href="classQmitkMITKIGTTrackingToolboxView.html#a9fe9ea3d8d3f6fc4b9fdec86f28ffbab">m_Worker</a>; }</div>
</div><!-- fragment --><p>Return to the <a class="el" href="IGTTutorialOverview.html">[IGT Tutorial Overview]</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="mitkigt.html">MITK-IGT</a></li><li class="navelem"><a class="el" href="IGTTutorialOverview.html">IGT Tutorial Overview</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0 </li>
  </ul>
</div>
</body>
</html>
